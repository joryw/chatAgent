version: '3.8'

################################################################################
# Docker Compose - SearXNG + AI Agent 完整部署
# 
# 使用方法:
#   1. 确保已配置 .env 文件 (包含 API keys)
#   2. 运行: docker-compose -f docker-compose.full.yml up -d
#   3. 访问 http://localhost:8000
#
# 注意:
#   - SearXNG 运行在 8080 端口
#   - AI Agent 运行在 8000 端口
#   - 需要在 .env 中配置至少一个 LLM 提供商的 API key
################################################################################

services:
  # SearXNG 搜索引擎
  searxng:
    image: searxng/searxng:latest
    container_name: searxng
    ports:
      - "8080:8080"
    volumes:
      - ./searxng-data:/etc/searxng:rw
    environment:
      - SEARXNG_BASE_URL=http://localhost:8080/
      - SEARXNG_PORT=8080
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - ai-agent-network

  # AI Agent (可选 - 需要先构建镜像)
  # 取消注释以下内容启用 AI Agent 容器
  # ai-agent:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: ai-agent
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     # 从 .env 文件读取配置
  #     - OPENAI_API_KEY=${OPENAI_API_KEY}
  #     - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
  #     - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
  #     - DEFAULT_PROVIDER=${DEFAULT_PROVIDER:-openai}
  #     - SEARXNG_URL=http://searxng:8080
  #     - SEARCH_ENABLED=true
  #     - LOG_LEVEL=${LOG_LEVEL:-INFO}
  #   depends_on:
  #     - searxng
  #   restart: unless-stopped
  #   networks:
  #     - ai-agent-network

networks:
  ai-agent-network:
    driver: bridge

volumes:
  searxng-data:

