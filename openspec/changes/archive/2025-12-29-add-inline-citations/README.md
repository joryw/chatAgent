# å†…è”å¼•ç”¨é“¾æ¥åŠŸèƒ½

## æ¦‚è¿°

å†…è”å¼•ç”¨é“¾æ¥åŠŸèƒ½å°†æ¨¡å‹å›ç­”ä¸­çš„å¼•ç”¨æ ‡è®°(å¦‚ [1]ã€[2])è½¬æ¢ä¸ºå¯ç‚¹å‡»çš„é“¾æ¥,è®©ç”¨æˆ·èƒ½å¤Ÿç›´æ¥è·³è½¬åˆ°æ¥æºç½‘é¡µ,æå‡ä¿¡æ¯çš„å¯è¿½æº¯æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## åŠŸèƒ½äº®ç‚¹

### ğŸ”— æ™ºèƒ½å¼•ç”¨è½¬æ¢
- è‡ªåŠ¨è¯†åˆ«å›ç­”ä¸­çš„å¼•ç”¨æ ‡è®° `[æ•°å­—]`
- è½¬æ¢ä¸ºå¯ç‚¹å‡»çš„ Markdown é“¾æ¥æ ¼å¼ `[[æ•°å­—]](url)`
- ä¿æŒå¼•ç”¨æ ‡è®°çš„è§†è§‰å‘ˆç°,ç”¨æˆ·å¯ç›´è§‚çœ‹åˆ°å¼•ç”¨ç¼–å·

### ğŸ“š å®Œæ•´å‚è€ƒæ–‡çŒ®
- åœ¨å›ç­”æœ«å°¾è‡ªåŠ¨ç”Ÿæˆ"å‚è€ƒæ–‡çŒ®"åˆ—è¡¨
- åŒ…å«å¼•ç”¨çš„å®Œæ•´ä¿¡æ¯:æ ‡é¢˜ã€URLã€åŸŸå
- æŒ‰ç¼–å·æ’åº,ä¾¿äºæŸ¥æ‰¾

### âš¡ æµå¼å¤„ç†æ”¯æŒ
- åœ¨æµå¼ç”Ÿæˆå›ç­”æ—¶å®æ—¶æ”¶é›†å†…å®¹
- å›ç­”å®Œæˆåç»Ÿä¸€å¤„ç†å¼•ç”¨
- ä¸å½±å“å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒ

### ğŸ›¡ï¸ å¥å£®çš„é”™è¯¯å¤„ç†
- è‡ªåŠ¨è¿‡æ»¤æ— æ•ˆçš„å¼•ç”¨ç¼–å·
- è½¬æ¢å¤±è´¥æ—¶ä¼˜é›…é™çº§
- è¯¦ç»†çš„æ—¥å¿—è®°å½•ä¾¿äºè°ƒè¯•

## ç”¨æˆ·ä½“éªŒæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æé—®] --> B{æœç´¢å¯ç”¨?}
    B -->|å¦| C[æ­£å¸¸å›ç­”]
    B -->|æ˜¯| D[æ‰§è¡Œæœç´¢]
    D --> E[è·å–æœç´¢ç»“æœ]
    E --> F[æ¨¡å‹ç”Ÿæˆå›ç­”]
    F --> G[å›ç­”ä¸­åŒ…å«å¼•ç”¨å¦‚ [1]]
    G --> H[å›ç­”ç”Ÿæˆå®Œæˆ]
    H --> I[CitationProcessor å¤„ç†]
    I --> J[è½¬æ¢ä¸º [[1]](url)]
    J --> K[æ·»åŠ å‚è€ƒæ–‡çŒ®åˆ—è¡¨]
    K --> L[æ›´æ–°æ˜¾ç¤º]
    L --> M[ç”¨æˆ·ç‚¹å‡»å¼•ç”¨é“¾æ¥]
    M --> N[æµè§ˆå™¨æ‰“å¼€æ¥æº]
```

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

**CitationProcessor** (`src/search/citation_processor.py`):
- å¼•ç”¨æ˜ å°„æ„å»º
- æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
- Markdown é“¾æ¥è½¬æ¢
- å‚è€ƒæ–‡çŒ®ç”Ÿæˆ

### é›†æˆç‚¹

**app.py**:
```python
# åœ¨æµå¼ç”Ÿæˆå®Œæˆå
if search_response and not search_response.is_empty() and response_msg:
    citation_processor = CitationProcessor(search_response)
    processed_response = citation_processor.process_response(full_response)
    response_msg.content = processed_response
    await response_msg.update()
```

### æ•°æ®æµ

```
SearchResponse â†’ CitationProcessor â†’ Citation Map
     â†“
Model Response â†’ Pattern Matching â†’ Extract [num]
     â†“
Validate num â†’ Convert to [[num]](url)
     â†“
Generate Citations List â†’ Append to Response
     â†“
Update UI â†’ Display Clickable Links
```

## ä½¿ç”¨ç¤ºä¾‹

### è¾“å…¥(ç”¨æˆ·æé—®)
```
Python æ˜¯ä»€ä¹ˆæ—¶å€™å‘å¸ƒçš„?
```

### è¾“å‡º(æ¨¡å‹å›ç­” - è½¬æ¢å‰)
```
Python æ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€[1]ï¼Œç”± Guido van Rossum äº 1991 å¹´é¦–æ¬¡å‘å¸ƒ[2]ã€‚
å®ƒä»¥å…¶ç®€æ´çš„è¯­æ³•å’Œå¼ºå¤§çš„åŠŸèƒ½è€Œé—»å[1]ã€‚
```

### è¾“å‡º(è½¬æ¢å - ç”¨æˆ·çœ‹åˆ°çš„)
```
Python æ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€[[1]](https://python.org)ï¼Œ
ç”± Guido van Rossum äº 1991 å¹´é¦–æ¬¡å‘å¸ƒ[[2]](https://wikipedia.org/python)ã€‚
å®ƒä»¥å…¶ç®€æ´çš„è¯­æ³•å’Œå¼ºå¤§çš„åŠŸèƒ½è€Œé—»å[[1]](https://python.org)ã€‚

---
**ğŸ“š å‚è€ƒæ–‡çŒ®:**

1. [Python Official Website](https://python.org) - `python.org`
2. [Python - Wikipedia](https://wikipedia.org/python) - `wikipedia.org`
```

## é…ç½®é€‰é¡¹

åŠŸèƒ½è‡ªåŠ¨å¯ç”¨,æ— éœ€é¢å¤–é…ç½®ã€‚ä½†éœ€è¦:
- âœ… SearXNG æœç´¢æœåŠ¡è¿è¡Œä¸­
- âœ… ç”¨æˆ·ç•Œé¢ä¸­å¯ç”¨"è”ç½‘æœç´¢"å¼€å…³
- âœ… æ¨¡å‹åœ¨å›ç­”ä¸­ä½¿ç”¨ [æ•°å­—] æ ¼å¼å¼•ç”¨

## æµ‹è¯•éªŒè¯

å®Œæ•´çš„æµ‹è¯•æŒ‡å—è¯·å‚è€ƒ: [TESTING_GUIDE.md](./TESTING_GUIDE.md)

åŸºæœ¬æµ‹è¯•æ­¥éª¤:
1. å¯åŠ¨åº”ç”¨: `chainlit run app.py -w`
2. å¯ç”¨è”ç½‘æœç´¢
3. æé—®éœ€è¦å¼•ç”¨æ¥æºçš„é—®é¢˜
4. éªŒè¯å¼•ç”¨é“¾æ¥å¯ç‚¹å‡»
5. éªŒè¯å‚è€ƒæ–‡çŒ®æ˜¾ç¤ºæ­£ç¡®

## å…¼å®¹æ€§

- âœ… ä¸ç°æœ‰æœç´¢åŠŸèƒ½å®Œå…¨å…¼å®¹
- âœ… æ”¯æŒæ‰€æœ‰æ¨¡å‹(OpenAIã€Anthropicã€DeepSeek)
- âœ… ä¸ DeepSeek Reasoner çš„æ¨ç†å±•ç¤ºåŠŸèƒ½å…¼å®¹
- âœ… å‘åå…¼å®¹,ä¸å½±å“æ— æœç´¢æ¨¡å¼

## æ€§èƒ½å½±å“

- å¼•ç”¨è½¬æ¢ä½¿ç”¨é«˜æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼,æ€§èƒ½å¼€é”€æå°
- å¤„ç† 10+ ä¸ªå¼•ç”¨çš„å“åº”æ—¶é—´ < 10ms
- ä¸å½±å“æµå¼ç”Ÿæˆé€Ÿåº¦
- å†…å­˜å ç”¨å¯å¿½ç•¥

## å·²çŸ¥é™åˆ¶

1. **å¼•ç”¨æ ¼å¼é™åˆ¶**: ä»…æ”¯æŒ `[æ•°å­—]` æ ¼å¼,ä¸æ”¯æŒ `[1-3]` æˆ– `[1,2,3]`
2. **ç¼–å·èŒƒå›´**: åªè½¬æ¢æœ‰æ•ˆçš„å¼•ç”¨ç¼–å·(åœ¨æœç´¢ç»“æœæ•°é‡èŒƒå›´å†…)
3. **Markdown ä¾èµ–**: ä¾èµ– Chainlit çš„ Markdown æ¸²æŸ“èƒ½åŠ›

## åç»­æ”¹è¿›

- [ ] æ”¯æŒæ›´å¤šå¼•ç”¨æ ¼å¼(å¦‚ `[1-3]`)
- [ ] æ·»åŠ å¼•ç”¨ä½¿ç”¨é¢‘ç‡ç»Ÿè®¡
- [ ] æ”¯æŒè‡ªå®šä¹‰å¼•ç”¨æ ·å¼
- [ ] æ·»åŠ å¼•ç”¨éªŒè¯(æ£€æŸ¥ URL å¯è®¿é—®æ€§)
- [ ] æä¾›å¼•ç”¨ç®¡ç†ç•Œé¢

## ç›¸å…³æ–‡æ¡£

- [ææ¡ˆæ–‡æ¡£](./proposal.md) - å®Œæ•´çš„åŠŸèƒ½ææ¡ˆ
- [æŠ€æœ¯è®¾è®¡](./design.md) - è¯¦ç»†çš„æŠ€æœ¯è®¾è®¡æ–‡æ¡£
- [ä»»åŠ¡æ¸…å•](./tasks.md) - å®æ–½ä»»åŠ¡è·Ÿè¸ª
- [æµ‹è¯•æŒ‡å—](./TESTING_GUIDE.md) - è¯¦ç»†çš„æµ‹è¯•è¯´æ˜
- [è§„èŒƒå˜æ›´](./specs/web-search/spec.md) - OpenSpec è§„èŒƒæ›´æ–°

