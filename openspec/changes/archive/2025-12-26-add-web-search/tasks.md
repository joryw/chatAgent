# 实施任务清单

## 1. 基础架构
- [x] 1.1 创建 `src/search/` 模块目录结构
- [x] 1.2 实现 SearXNG 客户端封装类
- [x] 1.3 添加搜索结果数据模型定义
- [x] 1.4 实现搜索结果格式化和摘要工具

## 2. 配置管理
- [x] 2.1 在 `env.example` 添加 SearXNG 配置项示例
- [x] 2.2 在 `src/config/` 添加搜索配置类
- [x] 2.3 添加搜索参数配置(结果数量、超时时间等)

## 3. UI 界面
- [x] 3.1 在 Chainlit 聊天界面添加联网搜索开关控件
- [x] 3.2 实现搜索状态显示(搜索中、已完成等)
- [x] 3.3 设计并实现搜索源信息展示组件
- [x] 3.4 添加搜索结果引用标记

## 4. 搜索集成
- [x] 4.1 在消息处理流程中集成搜索触发逻辑
- [x] 4.2 实现搜索查询生成(从用户消息提取搜索关键词)
- [x] 4.3 实现搜索结果召回和排序
- [x] 4.4 将搜索结果注入到模型提示中

## 5. 提示工程
- [x] 5.1 修改 `src/prompts/templates.py` 支持搜索结果
- [x] 5.2 设计搜索结果注入的提示模板
- [x] 5.3 添加搜索源引用的提示指令

## 6. 错误处理
- [x] 6.1 实现搜索服务不可用时的降级策略
- [x] 6.2 添加搜索超时处理
- [x] 6.3 实现搜索结果为空的处理逻辑
- [x] 6.4 添加错误提示和用户反馈

## 7. 文档
- [x] 7.1 更新 README 添加联网搜索功能说明
- [x] 7.2 添加 SearXNG 部署和配置文档
- [x] 7.3 更新环境变量配置文档
- [x] 7.4 添加使用示例和最佳实践

## 8. 测试
- [x] 8.1 手动测试搜索开关功能
- [x] 8.2 测试不同类型的搜索查询
- [x] 8.3 测试搜索结果展示
- [x] 8.4 测试错误场景和边界情况

## 实施总结

✅ **已完成的功能：**

1. **搜索模块架构** (`src/search/`)
   - `models.py` - 搜索结果数据模型
   - `searxng_client.py` - SearXNG API 客户端
   - `search_service.py` - 搜索服务主逻辑
   - `formatter.py` - 结果格式化工具

2. **配置管理**
   - `src/config/search_config.py` - 搜索配置类
   - 环境变量配置支持
   - 可配置的搜索参数

3. **UI 集成**
   - Chainlit 搜索开关控件
   - 搜索状态实时显示
   - 搜索源信息展示
   - 引用标记支持

4. **核心功能**
   - 搜索结果召回
   - 结果注入到模型上下文
   - 搜索源引用
   - 错误处理和降级

5. **文档**
   - README 更新
   - SearXNG 部署指南
   - 环境变量说明
   - 使用示例

## 后续优化建议

- [ ] 添加单元测试和集成测试
- [ ] 实现智能搜索触发（自动判断是否需要搜索）
- [ ] 支持搜索结果缓存
- [ ] 添加搜索历史记录
- [ ] 支持多轮搜索对话

