# Change: 添加 Agent 模式支持

## Why

当前系统虽然支持联网搜索功能,但需要用户手动通过开关控制是否启用搜索。这种设计存在以下局限:

1. **缺乏智能决策能力**: 系统无法根据用户问题自动判断是否需要搜索
2. **交互体验不够灵活**: 用户需要在每次对话前预判是否需要联网信息
3. **无法实现迭代搜索**: 当一次搜索的结果不够充分时,系统无法自主决策是否需要再次搜索
4. **决策过程不透明**: 用户无法了解系统如何决策和执行搜索

为了提供更智能的对话体验,需要引入 Agent 模式,让 LLM 自主决策何时需要搜索、搜索什么内容,以及是否需要再次搜索,形成完整的 ReAct (Reasoning + Acting) 循环。

## What Changes

### 新增功能
- **Agent 模式**: 新增一个独立的对话模式,将搜索功能作为工具交给模型自主调用
- **ReAct 循环**: 实现 Reasoning (思考) → Acting (搜索) → Observing (观察结果) → Reasoning (再思考) 的循环流程
- **决策过程可视化**: 在 UI 中实时展示 Agent 的思考过程、工具调用和中间结果
- **模式切换**: 提供 Chat 模式和 Agent 模式的切换能力

### 修改现有功能
- **模式选择界面**: 修改 model-invocation 规范,在 UI 中添加模式选择器
- **搜索服务接口**: 修改 web-search 规范,使搜索服务支持作为 Agent 工具使用
- **LangChain Agent 集成**: 利用 LangChain 的 Agent 框架实现 ReAct 模式

### 核心特性
1. **Chat 模式 (现有增强)**:
   - 保持现有的对话体验
   - 支持手动开关联网搜索
   - 适合简单的对话场景

2. **Agent 模式 (新增)**:
   - 模型自主决策是否需要搜索
   - 支持多轮搜索迭代
   - 展示完整的决策和执行过程
   - 适合需要实时信息的复杂问题

## Impact

### 影响的规范
- **新增规范**: `agent-mode` - 全新的 Agent 模式功能
- **修改规范**: `model-invocation` - 添加模式选择和 UI 交互
- **修改规范**: `web-search` - 支持作为 Agent 工具使用

### 影响的代码
- **应用层**: `app.py` - 添加模式选择器和 Agent 流程处理
- **Agent 层** (新增): `src/agents/` - 实现 Agent 控制器和 ReAct 循环
- **工具层** (新增): `src/agents/tools/` - 将搜索封装为 LangChain Tool
- **模型层**: `src/models/` - 可能需要增加对函数调用的支持
- **搜索层**: `src/search/` - 适配 Agent 工具接口

### 用户体验变化
- **向后兼容**: Chat 模式保持原有体验,不影响现有用户
- **新增选择**: 用户可以根据需求选择合适的模式
- **更透明**: Agent 模式提供完整的决策过程可视化

### 技术依赖
- **LangChain Agents**: 使用 LangChain 的 Agent 框架
- **LangChain Tools**: 使用 LangChain 的 Tool 抽象
- **流式输出**: 需要支持 Agent 执行过程的流式展示

### 潜在风险
- **成本增加**: Agent 模式可能产生更多的 token 消耗
- **响应延迟**: 多轮思考和搜索可能增加响应时间
- **复杂度提升**: Agent 的行为可能不够可预测

