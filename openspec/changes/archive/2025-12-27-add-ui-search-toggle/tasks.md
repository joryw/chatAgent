# Implementation Tasks

## 1. 规范更新
- [x] 1.1 更新 `specs/web-search/spec.md` delta,添加UI控件场景

## 2. 核心功能实现
- [x] 2.1 在 `app.py` 中导入 ChatSettings 相关类型
- [x] 2.2 实现 `@cl.on_settings_update` 回调函数
  - 处理搜索开关状态变化
  - 更新 user_session 中的 `search_enabled` 状态
  - 发送状态变更确认消息
- [x] 2.3 在 `@cl.on_chat_start` 中初始化 ChatSettings
  - 创建搜索开关控件
  - 设置默认状态(关闭)
  - 检查搜索服务可用性,不可用时禁用控件

## 3. UI和消息增强
- [x] 3.1 优化欢迎消息中的搜索状态显示
  - 添加UI开关位置提示
  - 说明两种控制方式(UI开关和命令)
- [x] 3.2 增强 `/config` 命令输出
  - 显示搜索开关的当前状态
  - 提示UI开关位置
- [x] 3.3 更新 `/help` 命令说明
  - 添加UI开关的使用说明

## 4. 兼容性和测试
- [x] 4.1 确保 `/search` 命令与UI开关同步
  - 命令修改状态时更新UI
  - UI修改状态时命令查询返回正确状态
- [x] 4.2 测试搜索服务不可用时的UI表现
  - UI开关应被禁用
  - 显示适当的提示信息
- [x] 4.3 测试状态持久性
  - 确认状态在会话期间正确保持

## 5. 文档更新
- [x] 5.1 更新用户文档,说明UI开关功能
- [x] 5.2 添加UI开关使用截图或说明

## 6. 验证
- [x] 6.1 运行 `openspec validate add-ui-search-toggle --strict`
- [x] 6.2 测试完整的用户流程
  - 启动应用
  - 通过UI开关启用搜索
  - 发送需要搜索的下·题
  - 验证搜索结果显示
  - 通过UI关闭搜索
  - 通过命令再次启用
  - 验证UI状态同步
- [x] 6.3 测试边界情况
  - 搜索服务不可用时的表现
  - 快速切换开关多次
  - 会话重启后的状态

