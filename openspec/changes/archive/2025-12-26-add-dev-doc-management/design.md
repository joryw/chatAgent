# 技术设计文档

## Context

当前项目通过AI辅助开发,自动生成了大量英文文档堆积在根目录,造成以下问题:
- 根目录混乱,影响项目可读性
- 缺乏中文支持,不便于中文团队协作
- 文档缺少组织和分类
- 难以维护和查找

需要建立规范的文档管理系统,支持中英文双语,提升团队协作效率。

**约束条件:**
- 保持与现有Git工作流兼容
- 不引入额外的构建工具或依赖
- 保持文档的可访问性(纯Markdown格式)
- 兼容GitHub/GitLab等平台的文档渲染

**相关方:**
- 开发团队(需要开发文档和API文档)
- 新成员(需要快速上手指南)
- 项目维护者(需要管理和更新文档)

## Goals / Non-Goals

### Goals
- 建立清晰的文档目录结构,按类型分类存放
- 支持中英文文档的共存和管理
- 提供标准化的文档模板
- 定义文档元数据规范
- 实现现有文档的平滑迁移
- 提升文档的可发现性和可维护性

### Non-Goals
- 不引入复杂的文档生成工具(如Sphinx、Docusaurus等)
- 不实现自动翻译功能
- 不建立文档版本管理系统(依赖Git)
- 不实现文档搜索功能(依赖IDE或GitHub搜索)

## Decisions

### 决策 1: 目录结构设计

**选择:**
```
docs/
├── README.md                    # 文档导航和索引
├── architecture/                # 架构文档
│   ├── overview/               # 架构概览
│   ├── design-decisions/       # 设计决策记录
│   └── implementation/         # 实现细节
├── development/                 # 开发文档
│   ├── setup/                  # 环境搭建
│   ├── contributing/           # 贡献指南
│   └── coding-standards/       # 编码规范
├── guides/                      # 用户指南
│   ├── quick-start/            # 快速开始
│   ├── configuration/          # 配置指南
│   └── tutorials/              # 教程
├── api/                         # API文档
│   ├── rest-api/               # REST API
│   └── sdk/                    # SDK文档
├── operations/                  # 运维文档
│   ├── deployment/             # 部署指南
│   ├── monitoring/             # 监控
│   └── troubleshooting/        # 故障排查
└── templates/                   # 文档模板
    ├── feature-design.md       # 功能设计模板
    ├── api-doc.md              # API文档模板
    └── ...
```

**原因:**
- 按文档用途和受众分类,符合直觉
- 支持细分子目录,便于扩展
- 每个分类都有明确的职责范围
- 便于团队成员快速定位所需文档

**替代方案:**
- 按模块/功能分类: 不适合,因为文档类型更重要
- 扁平结构: 文档多时难以维护
- 按语言分类(中文/英文): 不利于同主题文档的组织

### 决策 2: 中英文文档组织方式

**选择:** 同目录下中英文文件并存,使用后缀区分

**示例:**
```
docs/guides/quick-start/
├── README.md           # 英文版
├── README.zh-CN.md     # 中文版
└── images/             # 共享的图片资源
```

**原因:**
- 相同主题的中英文文档物理位置接近,便于维护
- 文件名清晰,易于识别语言版本
- 符合国际化(i18n)的常见做法
- 图片等资源可以共享

**替代方案:**
- 分离目录(docs/zh-CN/, docs/en/): 维护成本高,资源重复
- 在文档内使用多语言章节: 单个文件过大,不便于阅读

### 决策 3: 文档元数据格式

**选择:** 使用YAML Front Matter格式

**示例:**
```markdown
---
title: 快速开始指南
title_en: Quick Start Guide
type: guide
audience: [developers, users]
created: 2024-12-26
updated: 2024-12-26
version: 1.0.0
tags: [setup, getting-started]
lang: zh-CN
related:
  - docs/development/setup/README.md
  - docs/guides/configuration/README.md
---

# 快速开始指南

...
```

**原因:**
- YAML Front Matter是Markdown生态系统的标准做法
- 结构化,便于程序解析(如果将来需要)
- 不影响文档正文的可读性
- 支持嵌套结构,可扩展

**替代方案:**
- 文档内使用表格: 不够结构化,难以解析
- 单独的JSON/YAML元数据文件: 增加文件数量,维护复杂

### 决策 4: 文档迁移策略

**选择:** 渐进式迁移,保留重要文档,归档过时内容

**策略:**
1. **保留在根目录:** README.md, LICENSE, CONTRIBUTING.md (更新链接)
2. **迁移到分类目录:** 其他所有文档按类型分类迁移
3. **处理重复文档:** 合并内容或选择最新版本
4. **归档过时文档:** 移动到 docs/archive/ 或删除

**原因:**
- 保持项目入口的标准化(README等是约定俗成的)
- 避免破坏外部链接(如果有)
- 渐进式迁移降低风险
- 明确归档策略避免信息丢失

**迁移检查清单:**
- 更新所有内部文档链接
- 在根目录README中添加文档索引链接
- 团队成员确认新结构可用
- 清理或归档旧文件

### 决策 5: 文档模板设计

**选择:** 提供最小化但完整的模板,包含必要章节和示例

**模板原则:**
- 包含YAML Front Matter的元数据示例
- 定义必需章节和可选章节
- 提供简短的填写说明和示例
- 保持简洁,避免过度规范

**示例模板结构:**
```markdown
---
[元数据示例]
---

# [文档标题]

## 概述
[简要说明文档目的和范围]

## [核心章节 1]
...

## [核心章节 2]
...

## 参考资料
...
```

**原因:**
- 标准化文档格式,提升一致性
- 降低新文档创建门槛
- 确保关键信息不会遗漏
- 作为最佳实践的示范

## Risks / Trade-offs

### 风险 1: 文档迁移时链接失效
- **影响:** 团队成员可能找不到文档或遇到404链接
- **缓解:** 
  - 使用脚本检查所有Markdown文件中的链接
  - 在根目录README中提供新的文档导航
  - 在旧位置添加重定向说明(如果可能)

### 风险 2: 团队成员不熟悉新结构
- **影响:** 可能继续在错误位置创建文档
- **缓解:**
  - 在CONTRIBUTING.md中明确说明文档规范
  - 提供文档创建检查清单
  - 代码审查时检查文档位置

### 风险 3: 中英文文档不同步
- **影响:** 文档内容可能出现不一致
- **缓解:**
  - 在文档元数据中记录更新时间
  - 鼓励更新英文文档时同步更新中文版
  - 在README中说明文档更新流程

### Trade-off 1: 文档组织的复杂度 vs 可维护性
- **选择:** 采用层次化目录结构
- **权衡:** 增加了一定的复杂度,但大幅提升了可维护性和可发现性
- **结论:** 对于中长期项目,结构化的收益远大于初期的学习成本

### Trade-off 2: 严格规范 vs 灵活性
- **选择:** 提供模板和建议,但不强制
- **权衡:** 在保证基本规范的同时,允许特殊情况的灵活处理
- **结论:** 适度规范,重点关注文档分类和元数据

## Migration Plan

### 阶段 1: 准备 (1-2小时)
1. 审查现有文档清单
2. 创建文档分类映射表
3. 创建新的目录结构
4. 准备文档模板

### 阶段 2: 迁移 (2-4小时)
1. 按分类迁移文档文件
2. 更新文档内部链接
3. 添加YAML Front Matter元数据
4. 创建中文版本(关键文档)

### 阶段 3: 验证 (1小时)
1. 检查链接有效性
2. 验证文档可访问性
3. 团队成员测试新结构

### 阶段 4: 清理 (30分钟)
1. 归档或删除旧文档
2. 更新根目录README
3. 提交Git并标记里程碑

### Rollback Plan
如果迁移出现问题:
1. Git回滚到迁移前的commit
2. 分析失败原因
3. 调整策略后重新迁移

## Open Questions

- [ ] 是否需要为文档添加自动化检查(CI/CD)?
- [ ] 是否需要文档审核流程?
- [ ] 如何处理API文档的自动生成(如从代码注释生成)?
- [ ] 是否需要文档贡献指南的模板?

